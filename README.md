# turl-release

Automated semantic versioning, cleanup, changelog generation, and release commits for React projects.

by Trent

---

## Table of Contents

- [Installation](#installation)
- [Quick Start](#quick-start)
- [Configuration](#configuration)
- [Usage](#usage)
- [What It Does](#what-it-does)
- [Error Handling](#error-handling)
- [Supported Projects](#supported-projects)
- [License](#license)

---

## Installation

```bash
npm install --save-dev turl-release
```

Add to your `package.json` scripts:

```json
{
  "scripts": {
    "release": "turl-release"
  }
}
```

---

## Quick Start

### 1. Create `.env` file

Create a `.env` file in your project root with your Grok API key:

```env
GROK_API_KEY=xai-your-api-key-here
```

Get your API key from [console.x.ai](https://console.x.ai)

Add `.env` to your `.gitignore`:

```
.env
```

### 2. Run your first release

```bash
npm run release
```

That's it! The tool will auto-generate a `public/turl.json` config file on first run.

---

## Configuration

### turl.json

Location: `public/turl.json`

This file is auto-generated on first run, but you can create or edit it manually:

```json
{
  "version": "1.0",
  "projectName": "my-app",
  "branch": "main"
}
```

| Field         | Type     | Description                               | Default          |
| ------------- | -------- | ----------------------------------------- | ---------------- |
| `version`     | `string` | Current version number (auto-incremented) | `"1.0"`          |
| `projectName` | `string` | Project name used in commit messages      | Your folder name |
| `branch`      | `string` | Default git branch to push to             | `"main"`         |

### API Key

Each project using turl-release needs its own `.env` file with the API key.

Supported environment variable names (checked in this order):

1. `GROK_API_KEY`
2. `REACT_APP_GROK_API_KEY`

---

## Usage

### Basic Release

```bash
npm run release
```

or

```bash
npx turl-release
```

### Override Branch

Push to a different branch than what's configured in `turl.json`:

```bash
npx turl-release --branch develop
npx turl-release -b feature/my-branch
```

### Help

```bash
npx turl-release --help
```

### Debug Mode

Enable debug output for troubleshooting:

```bash
DEBUG=1 npx turl-release
```

---

## What It Does

| Step | Action                                             |
| ---- | -------------------------------------------------- |
| 0    | Pre-flight checks (git, remote, dependencies)      |
| 1    | Load API key from project `.env`                   |
| 2    | Read config from `public/turl.json` (or create it) |
| 3    | Increment version (1.2 -> 1.3, 1.9 -> 2.0)         |
| 4    | Remove `console.log()` calls from `src/`           |
| 5    | Remove unused CSS classes from `src/`              |
| 6    | Run code formatter (if available)                  |
| 7    | Check for changes (exit gracefully if none)        |
| 8    | Update `public/turl.json` with new version         |
| 9    | Generate changelog via Grok AI                     |
| 10   | Update `CHANGELOG.md`                              |
| 11   | Run production build                               |
| 12   | Stage, commit, and push                            |

### Version Rollback

If any step fails after the version is updated, the tool automatically rolls back `turl.json` to the original version. Your project won't be left in a broken state.

### Commit Message Format

Commit messages are generated by AI based on actual code changes:

```
my-app: Release v1.3

- Added user authentication flow
- Fixed navigation bug on mobile
- Updated button styling in header
```

### Changelog Format

Changelog entries follow a standard format and only include actual code changes (not version bumps):

```markdown
## [1.3] - 2026-02-02

- Added user authentication flow
- Fixed navigation bug on mobile
- Updated button styling in header
```

---

## Project Structure

Minimum required structure:

```
my-project/
  .env                    <- Your GROK_API_KEY (required)
  public/
    turl.json             <- Auto-generated config
  src/                    <- Source files (cleanup runs here)
  package.json
```

---

## Error Handling

The tool includes comprehensive error handling for common issues:

| Category | Errors Handled                                                       |
| -------- | -------------------------------------------------------------------- |
| Git      | Not installed, not a repo, no remote, push rejected, auth failures   |
| API      | Missing key, invalid key, network errors, rate limits, server errors |
| Files    | Permission denied, not found, no disk space, invalid JSON            |
| Build    | Prettier not installed, build command failures                       |
| Cleanup  | Directory access errors, file read/write errors                      |

### Strict Mode

The release will fail (not proceed with fallback messages) if:

- API key is missing or invalid
- Changelog generation fails
- Commit message generation fails

This ensures you never have generic "Version bump" commits.

---

## Supported Projects

- Create React App
- Vite + React
- Any React project with a `src/` directory

---

## Version Format

Versions follow a simple MAJOR.MINOR pattern:

```
1.0 -> 1.1 -> 1.2 -> ... -> 1.9 -> 2.0 -> 2.1 -> ...
```

---

## Development

### Using turl-release on itself

This tool can release itself:

```bash
cd /path/to/turl-release
npm run release
```

### Global Link (for development)

```bash
cd /path/to/turl-release
npm link

cd /path/to/your-project
npm link turl-release
```

---

## License

MIT - Free for everyone to use, modify, and distribute.

See [LICENSE.md](LICENSE.md) for full details.
